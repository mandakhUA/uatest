<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>main</title>  
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
   
</head>
<body onload="load()">
    
    <div class="progress">
        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
      maintest
    <form>
        <select id="searchval">
            <option value="mobile" selected>mobile</option>
            <option value="regno">regno</option>
            <option value="id">id</option>
          </select>
        <input type="text" id="bb" value="" placeholder="utas" onchange="findcon()" />
        <input type="button" value="send" onclick="findcon()"/>        
        <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#uaconsumer">uaconsumer</button>
        <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#createpc">create_pc</button>
        <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#updatepc">update_pc</button>
        <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#changepc">change_pc</button>
        <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#addmember">add_member</button>
        <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#acceptreq">accept_req</button>
        <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#rejectreq">reject_req</button>
        <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#quitfam">quit_fam</button>
        <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#delgr">del_group</button>
        <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#remmem">rem_mem</button>
        <button type="button" class="btn btn-info" data-toggle="collapse" data-target="#changeadmin">change_admin</button>
        <div id="remmem" class="collapse"><p class="text-info"><b>rem_mem</b></p>
            <div><input type="text" name="remmem_token" id="remmem_token" placeholder="token"/>
                <select id="remmem_token_sel" onchange="token_select('remmem_token_sel','remmem_token')">
                    <option value="" selected>tokens</option>
                    <option value="7900b7fe2e28fa86cda82cd11b204e13ae9097e2">nomin</option>
                    <option value="83027b6ff8ba971fd07d48a3d67a544a6ee28104">DDISHTV</option>
                    <option value="74b799b979e77e54fbdd6bc3c2b4761e1a487be2">Monos UB</option>
                    <option value="747a67c09f665701e723e1652253394c2f32a11e">Unitel</option>
                    <option value="024164dc1a027029d3d59cfc988ef6f15231d94c">MetroExpress</option>
                    <option value="8b8a09a36f9e3e80ffadd81f8daed268800a470d">Univision</option>
                    <option value="06be024370fca7aaf0a4c2aa9caa91f47da02e5c">UA</option>
                </select>
                <input type="button" value="[]" onclick="check_token('remmem_token', 'remmem_token_msg')"/><span id="remmem_token_msg"></span></div>  
            <div><input type="text" name="remmem_mobile" id="remmem_mobile" placeholder="mobile" onchange="check_mobile('remmem_mobile', 'remmem_mobile_msg')"/><input type="button" value="[]" onclick="check_mobile('remmem_mobile', 'remmem_mobile_msg')"/><span id="remmem_mobile_msg"></span></div>          
            <div><input type="button" value="send" onclick="send_url('remmem', 'remmem_msg')"/><span id="remmem_msg"></span></div>
        </div>
        <div id="changeadmin" class="collapse"><p class="text-info"><b>change_admin</b></p>
            <div><input type="text" name="changeadmin_token" id="changeadmin_token" placeholder="token"/>
                <select id="changeadmin_token_sel" onchange="token_select('changeadmin_token_sel','changeadmin_token')">
                    <option value="" selected>tokens</option>
                    <option value="7900b7fe2e28fa86cda82cd11b204e13ae9097e2">Nomin</option>
                    <option value="83027b6ff8ba971fd07d48a3d67a544a6ee28104">DDISHTV</option>
                    <option value="74b799b979e77e54fbdd6bc3c2b4761e1a487be2">Monos UB</option>
                    <option value="747a67c09f665701e723e1652253394c2f32a11e">Unitel</option>
                    <option value="024164dc1a027029d3d59cfc988ef6f15231d94c">MetroExpress</option>
                    <option value="8b8a09a36f9e3e80ffadd81f8daed268800a470d">Univision</option>
                    <option value="06be024370fca7aaf0a4c2aa9caa91f47da02e5c">UA</option>
                </select>
                <input type="button" value="[]" onclick="check_token('changeadmin_token', 'changeadmin_token_msg')"/><span id="changeadmin_token_msg"></span></div>  
            <div><input type="text" name="changeadmin_mobile" id="changeadmin_mobile" placeholder="mobile" onchange="check_mobile('changeadmin_mobile', 'changeadmin_mobile_msg')"/><input type="button" value="[]" onclick="check_mobile('changeadmin_mobile', 'changeadmin_mobile_msg')"/><span id="changeadmin_mobile_msg"></span></div>          
            <div><input type="button" value="send" onclick="send_url('changeadmin', 'changeadmin_msg')"/><span id="changeadmin_msg"></span></div>
        </div>
        <div id="delgr" class="collapse"><p class="text-info"><b>del_group</b></p>
            <div><input type="text" name="delgr_token" id="delgr_token" placeholder="token"/>
                <select id="delgr_token_sel" onchange="token_select('delgr_token_sel','delgr_token')">
                    <option value="" selected>tokens</option>
                    <option value="7900b7fe2e28fa86cda82cd11b204e13ae9097e2">Nomin</option>
                    <option value="83027b6ff8ba971fd07d48a3d67a544a6ee28104">DDISHTV</option>
                    <option value="74b799b979e77e54fbdd6bc3c2b4761e1a487be2">Monos UB</option>
                    <option value="747a67c09f665701e723e1652253394c2f32a11e">Unitel</option>
                    <option value="024164dc1a027029d3d59cfc988ef6f15231d94c">MetroExpress</option>
                    <option value="8b8a09a36f9e3e80ffadd81f8daed268800a470d">Univision</option>
                    <option value="06be024370fca7aaf0a4c2aa9caa91f47da02e5c">UA</option>
                </select>
                <input type="button" value="[]" onclick="check_token('delgr_token', 'delgr_token_msg')"/><span id="delgr_token_msg"></span></div>              
            <div><input type="button" value="send" onclick="send_url('delgr', 'delgr_msg')"/><span id="delgr_msg"></span></div>
        </div>
        <div id="quitfam" class="collapse"><p class="text-info"><b>quit_fam</b></p>
            <div><input type="text" name="quitfam_token" id="quitfam_token" placeholder="token"/>
                <select id="quitfam_token_sel" onchange="token_select('quitfam_token_sel','quitfam_token')">
                    <option value="" selected>tokens</option>
                    <option value="7900b7fe2e28fa86cda82cd11b204e13ae9097e2">Nomin</option>
                    <option value="83027b6ff8ba971fd07d48a3d67a544a6ee28104">DDISHTV</option>
                    <option value="74b799b979e77e54fbdd6bc3c2b4761e1a487be2">Monos UB</option>
                    <option value="747a67c09f665701e723e1652253394c2f32a11e">Unitel</option>
                    <option value="024164dc1a027029d3d59cfc988ef6f15231d94c">MetroExpress</option>
                    <option value="8b8a09a36f9e3e80ffadd81f8daed268800a470d">Univision</option>
                    <option value="06be024370fca7aaf0a4c2aa9caa91f47da02e5c">UA</option>
                </select>
                <input type="button" value="[]" onclick="check_token('quitfam_token', 'quitfam_token_msg')"/><span id="quitfam_token_msg"></span></div>              
            <div><input type="button" value="send" onclick="send_url('quitfam', 'quitfam_msg')"/><span id="quitfam_msg"></span></div>
        </div>
        <div id="rejectreq" class="collapse"><p class="text-info"><b>reject_req</b></p>
            <div><input type="text" name="rejectreq_token" id="rejectreq_token" placeholder="token"/>
                <select id="rejectreq_token_sel" onchange="token_select('rejectreq_token_sel','rejectreq_token')">
                    <option value="" selected>tokens</option>
                    <option value="7900b7fe2e28fa86cda82cd11b204e13ae9097e2">Nomin</option>
                    <option value="83027b6ff8ba971fd07d48a3d67a544a6ee28104">DDISHTV</option>
                    <option value="74b799b979e77e54fbdd6bc3c2b4761e1a487be2">Monos UB</option>
                    <option value="747a67c09f665701e723e1652253394c2f32a11e">Unitel</option>
                    <option value="024164dc1a027029d3d59cfc988ef6f15231d94c">MetroExpress</option>
                    <option value="8b8a09a36f9e3e80ffadd81f8daed268800a470d">Univision</option>
                    <option value="06be024370fca7aaf0a4c2aa9caa91f47da02e5c">UA</option>
                </select>
                <input type="button" value="[]" onclick="check_token('rejectreq_token', 'rejectreq_token_msg')"/><span id="rejectreq_token_msg"></span></div>  
            <div><input type="text" name="rejectreq_famid" id="rejectreq_famid" placeholder="famid" onchange="check_family('rejectreq_famid', 'rejectreq_famid_msg')"/><input type="button" value="[]" onclick="check_family('rejectreq_famid', 'rejectreq_famid_msg')"/><span id="rejectreq_famid_msg"></span></div>          
            <div><input type="button" value="send" onclick="send_url('rejectreq', 'rejectreq_msg')"/><span id="rejectreq_msg"></span></div>
        </div>
        <div id="acceptreq" class="collapse"><p class="text-info"><b>accept_req</b></p>
            <div><input type="text" name="acceptreq_token" id="acceptreq_token" placeholder="token"/>
                <select id="acceptreq_token_sel" onchange="token_select('acceptreq_token_sel','acceptreq_token')">
                    <option value="" selected>tokens</option>
                    <option value="7900b7fe2e28fa86cda82cd11b204e13ae9097e2">Nomin</option>
                    <option value="83027b6ff8ba971fd07d48a3d67a544a6ee28104">DDISHTV</option>
                    <option value="74b799b979e77e54fbdd6bc3c2b4761e1a487be2">Monos UB</option>
                    <option value="747a67c09f665701e723e1652253394c2f32a11e">Unitel</option>
                    <option value="024164dc1a027029d3d59cfc988ef6f15231d94c">MetroExpress</option>
                    <option value="8b8a09a36f9e3e80ffadd81f8daed268800a470d">Univision</option>
                    <option value="06be024370fca7aaf0a4c2aa9caa91f47da02e5c">UA</option>
                </select>
                <input type="button" value="[]" onclick="check_token('acceptreq_token', 'acceptreq_token_msg')"/><span id="acceptreq_token_msg"></span></div>  
            <div><input type="text" name="acceptreq_famid" id="acceptreq_famid" placeholder="famid" onchange="check_family('acceptreq_famid', 'acceptreq_famid_msg')"/><input type="button" value="[]" onclick="check_family('acceptreq_famid', 'acceptreq_famid_msg')"/><span id="acceptreq_famid_msg"></span></div>          
            <div><input type="button" value="send" onclick="send_url('acceptreq', 'acceptreq_msg')"/><span id="acceptreq_msg"></span></div>
        </div>
        <div id="addmember" class="collapse"><p class="text-info"><b>Add_member</b></p>
            <div><input type="text" name="addmember_token" id="addmember_token" placeholder="token"/>
                <select id="addmember_token_sel" onchange="token_select('addmember_token_sel','addmember_token')">
                    <option value="" selected>tokens</option>
                    <option value="7900b7fe2e28fa86cda82cd11b204e13ae9097e2">Nomin</option>
                    <option value="83027b6ff8ba971fd07d48a3d67a544a6ee28104">DDISHTV</option>
                    <option value="74b799b979e77e54fbdd6bc3c2b4761e1a487be2">Monos UB</option>
                    <option value="747a67c09f665701e723e1652253394c2f32a11e">Unitel</option>
                    <option value="024164dc1a027029d3d59cfc988ef6f15231d94c">MetroExpress</option>
                    <option value="8b8a09a36f9e3e80ffadd81f8daed268800a470d">Univision</option>
                    <option value="06be024370fca7aaf0a4c2aa9caa91f47da02e5c">UA</option>
                </select>
                <input type="button" value="[]" onclick="check_token('addmember_token', 'addmember_token_msg')"/><span id="addmember_token_msg"></span></div>  
            <div><input type="text" name="addmember_mobile" id="addmember_mobile" placeholder="mobile" onchange="check_mobile('addmember_mobile', 'addmember_mobile_msg')"/><input type="button" value="[]" onclick="check_mobile('addmember_mobile', 'addmember_mobile_msg')"/><span id="addmember_mobile_msg"></span></div>          
            <div><input type="button" value="send" onclick="send_url('addmember', 'addmember_msg')"/><span id="addmember_msg"></span></div>
        </div>
        <div id="changepc" class="collapse"><p class="text-info"><b>change_pc</b></p>
            <div><input type="text" name="changepc_token" id="changepc_token" placeholder="token"/>
                <select id="changepc_token_sel" onchange="token_select('changepc_token_sel','changepc_token')">
                    <option value="" selected>tokens</option>
                    <option value="7900b7fe2e28fa86cda82cd11b204e13ae9097e2">Nomin</option>
                    <option value="83027b6ff8ba971fd07d48a3d67a544a6ee28104">DDISHTV</option>
                    <option value="74b799b979e77e54fbdd6bc3c2b4761e1a487be2">Monos UB</option>
                    <option value="747a67c09f665701e723e1652253394c2f32a11e">Unitel</option>
                    <option value="024164dc1a027029d3d59cfc988ef6f15231d94c">MetroExpress</option>
                    <option value="8b8a09a36f9e3e80ffadd81f8daed268800a470d">Univision</option>
                    <option value="06be024370fca7aaf0a4c2aa9caa91f47da02e5c">UA</option>
                </select>
                <input type="button" value="[]" onclick="check_token('changepc_token', 'changepc_token_msg')"/><span id="changepc_token_msg"></span></div>            
            <div><input type="text" name="changepc_regno" id="changepc_regno" placeholder="regno" onchange="check_regno('changepc_regno','changepc_regno_msg')"/><input type="button" value="[]" onclick="check_regno('changepc_regno','changepc_regno_msg')"/><span id="changepc_regno_msg"></span></div>
            <div><input type="text" name="changepc_num1" id="changepc_num1" placeholder="num1" onchange="check_num('changepc_num1', 'changepc_num1_msg')"/><input type="button" value="[]" onclick="check_num('changepc_num1', 'changepc_num1_msg')"/><span id="changepc_num1_msg"></span></div>            
            <div><input type="text" name="changepc_num2" id="changepc_num2" placeholder="num2" onchange="check_num('changepc_num2', 'changepc_num2_msg')"/><input type="button" value="[]" onclick="check_num('changepc_num2', 'changepc_num2_msg')"/><span id="changepc_num2_msg"></span></div>            
            <div><input type="button" value="send" onclick="send_url('changepc', 'changepc_msg')"/><span id="changepc_msg"></span></div>

        </div>
        <div id="updatepc" class="collapse"><p class="text-info"><b>update_pc</b></p>
            <div><input type="text" name="updatepc_token" id="updatepc_token" placeholder="token"/>
                <select id="updatepc_token_sel" onchange="token_select('updatepc_token_sel','updatepc_token')">
                    <option value="" selected>tokens</option>
                    <option value="7900b7fe2e28fa86cda82cd11b204e13ae9097e2">Nomin</option>
                    <option value="83027b6ff8ba971fd07d48a3d67a544a6ee28104">DDISHTV</option>
                    <option value="74b799b979e77e54fbdd6bc3c2b4761e1a487be2">Monos UB</option>
                    <option value="747a67c09f665701e723e1652253394c2f32a11e">Unitel</option>
                    <option value="024164dc1a027029d3d59cfc988ef6f15231d94c">MetroExpress</option>
                    <option value="8b8a09a36f9e3e80ffadd81f8daed268800a470d">Univision</option>
                    <option value="06be024370fca7aaf0a4c2aa9caa91f47da02e5c">UA</option>
                </select>
                <input type="button" value="[]" onclick="check_token('updatepc_token', 'updatepc_token_msg')"/><span id="updatepc_token_msg"></span></div>            
            <div><input type="text" name="updatepc_regno" id="updatepc_regno" placeholder="regno" onchange="check_regno('updatepc_regno','updatepc_regno_msg')"/><input type="button" value="[]" onclick="check_regno('updatepc_regno','updatepc_regno_msg')"/><span id="updatepc_regno_msg"></span></div>
            <div><input type="text" name="updatepc_num" id="updatepc_num" placeholder="num" onchange="check_num('updatepc_num','updatepc_num_msg')"/><input type="button" value="[]" onclick="check_num('updatepc_num', 'updatepc_num_msg')"/><span id="updatepc_num_msg"></span></div>            
            <div><input type="button" value="send" onclick="send_url('updatepc', 'updatepc_msg')"/><span id="updatepc_msg"></span></div>

        </div>
        <div id="createpc" class="collapse"><p class="text-info"><b>create_pc</b></p>
            <div><input type="text" name="createpc_token" id="createpc_token" placeholder="token"/>
                <select id="createpc_token_sel" onchange="token_select('createpc_token_sel','createpc_token')">
                    <option value="" selected>tokens</option>
                    <option value="7900b7fe2e28fa86cda82cd11b204e13ae9097e2">Nomin</option>
                    <option value="83027b6ff8ba971fd07d48a3d67a544a6ee28104">DDISHTV</option>
                    <option value="74b799b979e77e54fbdd6bc3c2b4761e1a487be2">Monos UB</option>
                    <option value="747a67c09f665701e723e1652253394c2f32a11e">Unitel</option>
                    <option value="024164dc1a027029d3d59cfc988ef6f15231d94c">MetroExpress</option>
                    <option value="8b8a09a36f9e3e80ffadd81f8daed268800a470d">Univision</option>
                    <option value="06be024370fca7aaf0a4c2aa9caa91f47da02e5c">UA</option>
                </select>
                <input type="button" value="[]" onclick="check_token('createpc_token', 'createpc_token_msg')"/><span id="createpc_token_msg"></span></div>            
            <div><input type="text" name="createpc_regno" id="createpc_regno" placeholder="regno" onchange="check_regno('createpc_regno','createpc_regno_msg')"/><input type="button" value="[]" onclick="check_regno('createpc_regno','createpc_regno_msg')"/><span id="createpc_regno_msg"></span></div>
            <div><input type="text" name="createpc_num" id="createpc_num" placeholder="num" onchange="check_num('createpc_num', 'createpc_num_msg')"/><input type="button" value="[]" onclick="check_num('createpc_num', 'createpc_num_msg')"/><span id="createpc_num_msg"></span></div>            
            <div><input type="button" value="send" onclick="send_url('createpc', 'createpc_msg')"/><span id="createpc_msg"></span></div>
        </div>
        
        <div id="uaconsumer" class="collapse"><p class="text-info"><b>uaconsumer</b></p>
            <div><input type="text" name="uaconsumer_token" id="uaconsumer_token" placeholder="token"/>
                <select id="token_sel" onchange="token_select('token_sel','uaconsumer_token')">
                    <option value="" selected>tokens</option>
                    <option value="7900b7fe2e28fa86cda82cd11b204e13ae9097e2">Nomin</option>
                    <option value="83027b6ff8ba971fd07d48a3d67a544a6ee28104">DDISHTV</option>
                    <option value="74b799b979e77e54fbdd6bc3c2b4761e1a487be2">Monos UB</option>
                    <option value="747a67c09f665701e723e1652253394c2f32a11e">Unitel</option>
                    <option value="024164dc1a027029d3d59cfc988ef6f15231d94c">MetroExpress</option>
                    <option value="8b8a09a36f9e3e80ffadd81f8daed268800a470d">Univision</option>
                    <option value="06be024370fca7aaf0a4c2aa9caa91f47da02e5c">UA</option>
                </select>
                <input type="button" value="[]" onclick="check_token('uaconsumer_token', 'uaconsumer_token_msg')"/><span id="uaconsumer_token_msg"></span></div>
            <div><input type="text" name="uaconsumer_mobile" id="uaconsumer_mobile" placeholder="mobile" onchange="check_mobile('uaconsumer_mobile', 'uaconsumer_mobile_msg')"/><input type="button" value="[]" onclick="check_mobile('uaconsumer_mobile', 'uaconsumer_mobile_msg')"/><span id="uaconsumer_mobile_msg"></span></div>
            <div><input type="text" name="uaconsumer_regno" id="uaconsumer_regno" placeholder="regno" onchange="check_regno('uaconsumer_regno', 'uaconsumer_regno_msg')"/><input type="button" value="[]" onclick="check_regno('uaconsumer_regno', 'uaconsumer_regno_msg')"/><span id="uaconsumer_regno_msg"></span></div>
            <div><input type="text" name="uaconsumer_num" id="uaconsumer_num" placeholder="num" onchange="check_num('uaconsumer_num', 'uaconsumer_num_msg')"/><input type="button" value="[]" onclick="check_num('uaconsumer_num', 'uaconsumer_num_msg')"/><span id="uaconsumer_num_msg"></span></div>
            <div><input type="button" value="send" onclick="send_url('uaconsumer', 'uaconsumer_msg')"/><span id="uaconsumer_msg"></span></div>
        </div>
        <div id="aa1"></div>
    </form>
    <div id="accordion"></div>
    
    
  
    


    <script>
        function check_token(inpid, msgid){
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/api/check_token/' + document.getElementById(inpid).value, true);
            xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xhr.responseType= "json"
            xhr.onload = function () {
                con_tokens = xhr.response.con_tokens; console.log('con_tokens', con_tokens)
                mer_tokens = xhr.response.mer_tokens; console.log('mer_tokens', mer_tokens)
                msg = document.getElementById(msgid); msg.innerHTML=''
                if(con_tokens.length == 0 ) {msg.innerHTML = 'Энэ утас дээр бүртгэлтэй хэрэглэгч олдсонгүй.'} 
                else { msg.innerHTML = `&nbsp;${con_tokens.length}  Хэрэглэгч олдлоо. <a href='main?mobile='${con_tokens[0].mobile }'> ${con_tokens[0].mobile } </a>`;} 
                if(mer_tokens.length == 0 ) {msg.innerHTML += ' mer_tokens олдсонгүй.'} 
                else { msg.innerHTML += `&nbsp;${mer_tokens.length} mer олдлоо. ${mer_tokens[0].name}`;} 
            }
            xhr.send()
            
        }
        function token_select(id, id1){
            document.getElementById(id1).value = document.getElementById(id).value;
        }
        function send_url(func_name, msg_id){
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/api/sendurl/'+func_name, true);
            xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xhr.responseType= "json"
            xhr.onload = function () {
                d = xhr.response.data; console.log('send_url', d,msg_id)
                msg = document.getElementById(msg_id); msg.innerHTML=''
                if(Array.isArray(d)){msg.innerHTML = d[0]} 
                else if (typeof d === "object"){
                    if('detail' in d)   {msg.innerHTML +=" "+ d.detail}
                    if('message' in d)  {msg.innerHTML += `${d.message}`;  }
                    if('group_id' in d)  {msg.innerHTML += `${d.group_id} id:${d.id}`;  }
                    if('mobile' in d )  {msg.innerHTML += `<a href='main?mobile=${d.mobile}'>${d.mobile} </a>`}                    
                    if('result' in d)   {msg.innerHTML += `${d.result}`}                    
                    if('non_field_errors' in d)   {msg.innerHTML += `${d.non_field_errors}`} 
                } 
            }
            if(func_name == 'uaconsumer'){console.log('send');xhr.send(`token=${document.getElementById('uaconsumer_token').value}&mobile=${document.getElementById('uaconsumer_mobile').value}&registration_number=${document.getElementById('uaconsumer_regno').value}&card_number=${document.getElementById('uaconsumer_num').value}&nomin_card=&fee_type=0 &card_fee=0 &username=123`);}
            else if(func_name == 'createpc'){xhr.send(`token=${document.getElementById('createpc_token').value}&reg_no=${document.getElementById('createpc_regno').value}&card_no=${document.getElementById('createpc_num').value}&card_serial=&nfc_no=`);}
            else if(func_name == 'updatepc'){xhr.send(`token=${document.getElementById('updatepc_token').value}&reg_no=${document.getElementById('updatepc_regno').value}&card_no=${document.getElementById('updatepc_num').value}`);}
            else if(func_name == 'changepc'){xhr.send(`token=${document.getElementById('changepc_token').value}&reg_no=${document.getElementById('changepc_regno').value}&card_no_1=${document.getElementById('changepc_num1').value}&card_no_2=${document.getElementById('changepc_num2').value}`);}
            else if(func_name == 'addmember'){xhr.send(`token=${document.getElementById('addmember_token').value}&mobile=${document.getElementById('addmember_mobile').value}`);}            
            else if(func_name == 'acceptreq'){xhr.send(`token=${document.getElementById('acceptreq_token').value}&famid=${document.getElementById('acceptreq_famid').value}`);}            
            else if(func_name == 'rejectreq'){xhr.send(`token=${document.getElementById('rejectreq_token').value}&famid=${document.getElementById('rejectreq_famid').value}`);}            
            else if(func_name == 'quitfam'){xhr.send(`token=${document.getElementById('quitfam_token').value}`);}            
            else if(func_name == 'delgr'){xhr.send(`token=${document.getElementById('delgr_token').value}`);}            
            else if(func_name == 'remmem'){xhr.send(`token=${document.getElementById('remmem_token').value}&mobile=${document.getElementById('remmem_mobile').value}`);}            
            else if(func_name == 'changeadmin'){xhr.send(`token=${document.getElementById('changeadmin_token').value}&mobile=${document.getElementById('changeadmin_mobile').value}`);}            

        }
        

    

        function check_mobile(inpid, msgid){
            val = document.getElementById(inpid); console.log('mob', val.value)
            msg = document.getElementById(msgid);   
            if (val.value == '') { msg.innerHTML = 'Энэ талбарыг бөглөнө үү!'; }
            else{
                var xhr = new XMLHttpRequest();
                xhr.open('GET', '/api/check_mobile?mobile='+val.value, true);
                xhr.responseType= "json"
                xhr.onload = function () {
                    console.log('checkmoob', xhr.response)
                    msg.innerHTML = '';              
                    if (xhr.response.cons.length === 0){msg.innerHTML = ` Энэ утас дээр бүртгэлтэй хэр олдсонгүй. `}
                    else if (xhr.response.cons.length > 0){
                        msg.innerHTML += `&nbsp;${xhr.response.cons.length} Хэрэглэгч  олдлоо. cons: <a href='main?id=${xhr.response.cons[0]._id}' target="_blank">${xhr.response.cons[0]._id}</a>`
                    }
                    if (xhr.response.cards.length === 0){msg.innerHTML += ` Энэ утас дээр бүртгэлтэй карт олдсонгүй. `}
                    else if (xhr.response.cards.length > 0){
                        msg.innerHTML += `&nbsp;${xhr.response.cards.length}  Карт олдлоо. cards: <a href='card?id=${xhr.response.cards[0]._id['$oid']}' target="_blank">${xhr.response.cards[0]._id['$oid']}</a>`
                    }
                }
                xhr.send(null);
            }
        }
        function check_regno(inpid, msgid){
            val = document.getElementById(inpid); console.log('regno', val.value)
            msg = document.getElementById(msgid); 
            if (val.value == '') { msg.innerHTML = 'Энэ талбарыг бөглөнө үү!'; }
            else{
                var xhr = new XMLHttpRequest();
                xhr.open('GET', '/api/check_regno?regno='+val.value, true);
                xhr.responseType= "json"
                xhr.onload = function () {
                    console.log('checregno', xhr.response)
                    msg.innerHTML = ''; 
                    if (xhr.response.cons.length === 0){msg.innerHTML = ` Энэ РД дээр бүртгэлтэй хэр олдсонгүй. `}
                    else if (xhr.response.cons.length > 0){
                        msg.innerHTML += `&nbsp;${xhr.response.cons.length} Хэрэглэгч  олдлоо.  cons: <a href='main?id=${xhr.response.cons[0]._id}' target="_blank">${xhr.response.cons[0]._id}</a>`
                    }
                }
                xhr.send(null);
            }
        }
        function check_num(inpid, msgid){
            val = document.getElementById(inpid); console.log('num', val.value)
            msg = document.getElementById(msgid);   
            if (val.value == '') { msg.innerHTML = 'Энэ талбарыг бөглөнө үү!'; }
            else{
                var xhr = new XMLHttpRequest();
                xhr.open('GET', '/api/check_num?num='+val.value, true);
                xhr.responseType= "json"
                xhr.onload = function () {
                    console.log('checknum', xhr.response)
                    msg.innerHTML = '';                 
                    if (xhr.response.cards.length === 0){msg.innerHTML = ` Энэ дугаар дээр бүртгэлтэй карт олдсонгүй.. `}
                    else if (xhr.response.cards.length > 0){
                        msg.innerHTML += `&nbsp;${xhr.response.cards.length}  Карт олдлоо. cards: <a href='card?id=${xhr.response.cards[0]._id['$oid']}' target="_blank">${xhr.response.cards[0]._id['$oid']}</a>`
                        if (xhr.response.cards[0].cons.length === 0){msg.innerHTML += ` Энэ дугаар дээр бүртгэлтэй хэр олдсонгүй. `}
                        else if (xhr.response.cards[0].cons.length > 0){
                            msg.innerHTML += `&nbsp;${xhr.response.cards[0].cons.length} Хэрэглэгч  олдлоо. cons: <a href='main?id=${xhr.response.cards[0].cons[0]._id}' target="_blank">${xhr.response.cards[0].cons[0]._id}</a>`
                        }
                    }
                }
                xhr.send(null);
            }
        }
        function check_family(inpid, msgid){
            val = document.getElementById(inpid); console.log('fam', val.value)
            msg = document.getElementById(msgid);   
            if (val.value == '') { msg.innerHTML = 'Энэ талбарыг бөглөнө үү!'; }
            else{
                var xhr = new XMLHttpRequest();
                xhr.open('GET', '/api/check_fam?fam='+val.value, true);
                xhr.responseType= "json"
                xhr.onload = function () {
                    console.log('checkfum', xhr.response.fam)
                    msg.innerHTML = '';                 
                    if (!xhr.response.fam ){msg.innerHTML = ` Энэ дугаар дээр family олдсонгүй `}
                    else {
                        msg.innerHTML = ` bal: &nbsp;${xhr.response.fam.balance}. group member cnt: &nbsp;${xhr.response.fam.cfcnt} `
                    }
                }
                xhr.send(null);
            }
        }


        function load(){
            console.log('load')
            const params = new URLSearchParams(window.location.search);//console.log('params', params, params.has('id'), params.get('id'))
            if (params.has('mobile') || params.has('regno') || params.has('id')) {
                let searchval = document.getElementById("searchval"); //console.log('searchval',searchval.value)
                let bb = document.getElementById("bb");  //console.log(bb.value)
                if (params.has('mobile')) {searchval.value = "mobile"; bb.value=params.get('mobile');   }
                else if (params.has('regno')) {searchval.value = "regno"; bb.value=params.get('regno');   }
                else if (params.has('id')) {searchval.value = "id"; bb.value=params.get('id');   } 
            }
            
        }
        
        let pbx = 0;
        let pb = document.getElementsByClassName('progress-bar')[0]
        function incProgbar(){
            // console.log('pb', pb)
            pbx+=5;
            pb.style=`width: ${pbx}%`
            pb.setAttribute('aria-valuenow',pbx)
            pb.innerHTML = `${pbx}%`
        }

        function findcon(){  
            const myInterval = setInterval(incProgbar, 1000);          
            let searchval = document.getElementById("searchval"); //console.log('searchval',searchval.value)
            let bb = document.getElementById("bb");  //console.log(bb.value)
            var xhr = new XMLHttpRequest();
            xhr.open('GET', '/api/cons?'+ searchval.value +"="+bb.value, true);
            xhr.responseType= "json"
            xhr.onload = function () {
                clearInterval(myInterval); pbx = 0; pb.style=`width: 0%`; pb.setAttribute('aria-valuenow',0)
                let res = xhr.response; console.log('res', res); 
                let aa1 = document.getElementById("aa1") 
                if(!res.data){//hereglegch oldoq bol
                    aa1.innerHTML = `<p><b>Системд бүртгэлгүй хэрэглэгч</b></p>`
                } else {  //hereglegch oldson bol      
                d = res.data;
                   //                
                aa1.innerHTML = `<p><b>Хэрэглэгчийн мэдээлэл</b></p>
                <table class="table span12 table-striped table-bordered">
                    <tr><th>msg:</th><th>_id:</th><th>regno:</th><th>mob:</th><th>cardslen:</th><th>token:</th><th>bal:</th><th>bs:</th><th>isfam:</th></tr>
                    <tr>                                
                        <td style="width: 5%">${res.msg}</td>
                        <td style="width: 15%">${d._id}</td>
                        <td style="width: 20%">${d.profile.registration_number}</td>
                        <td style="width: 15%">${d.mobile}</td>
                        <td>${d.cards.length}</td>
                        <td>${d.token}</td>
                        <td style="width: 10%">${d.balance}</td>
                        <td>${d.balance_status}</td>
                        <td>${d.is_family}</td>
                    </tr>
                </table>`
                if (res.data.collective ){
                    c = res.data.collective;
                    cstring = `<p><b>Family_group</b></p><table class="table span12 table-striped table-hover table-bordered"><tr><th>fam_id: </th><th>fam_name: </th><th>bal: </th></tr>
                        <tr>
                            <td style="width: 20%">${c.family_id}</td>
                            <td style="width: 20%">${c.family_name}</td>
                            <td>${c.balance}</td>
                        </tr></table>`
                    if( c.congroups && c.congroups.length>0){
                        cstring +='<p><b>Consumer_family</b></p><table class="table span12 table-striped table-hover table-bordered"><tr><th>group: </th><th>isadmin: </th><th>consumer: </th></tr>'
                        for(let g=0; g<c.congroups.length; g++){      
                            cstring += `
                        <tr>                            
                            <td style="width: 20%">${c.congroups[g].group['$oid']}</td>
                            <td style="width: 20%">${c.congroups[g].is_admin}</td>
                            <td>${ c.congroups[g].consumer == d._id ? c.congroups[g].consumer : '<a href="/main?id='+c.congroups[g].consumer+'" target="_blank">' + c.congroups[g].consumer  + '</a>'}</td>                        
                        </tr>`
                        }
                        cstring += '</table>'
                    }
                    
                    if(c.gr_req.length >0 ){
                        gr_req_string =  `<p><b>Group_request</b></p><table class="table span12 table-striped table-hover table-bordered"><tr><th>cr_at: </th><th>st: </th><th>conid: </th></tr>`;
                        for(let h=0; h<c.gr_req.length; h++){ 
                            // gr_req_string += `<div>cr_at: ${c.gr_req[h].created_at['$date']} st: ${c.gr_req[h].status} conid: ${c.gr_req[h].consumer}</div>`
                            gr_req_string += `
                            <tr>
                                <td style="width: 20%">${c.gr_req[h].created_at['$date']}</td>
                                <td style="width: 20%">${c.gr_req[h].status}</td>
                                <td>${c.gr_req[h].consumer}</td>                            
                            </tr>`
                        }
                        gr_req_string += '</table>'
                        cstring+=gr_req_string;
                    }
                    if (c.con_coll.length>0){
                        con_coll_string = `consumer_collection<table class="table table-striped table-hover table-bordered"><tr><th>cr_at: </th><th>sender:</th><th>sender_mobile:</th><th>sender_mobile:</th><th>is_sender:</th><th>receiver: </th><th>receiver_mobile:</th><th>is_receiver</th><th>group</th><th>group_id</th></tr>s`;
                        for(let k=0; k<c.con_coll.length; k++){ 
                            // con_coll_string += `<div>cr_at: ${c.con_coll[k].created_at['$date']} sender: ${c.con_coll[k].sender} sender_mobile: ${c.con_coll[k].sender_mobile} is_sender: ${c.con_coll[k].is_sender} receiver: ${c.con_coll[k].receiver} receiver_mobile: ${c.con_coll[k].receiver_mobile} is_receiver ${c.con_coll[k].is_receiver} group ${c.con_coll[k].group['$oid']} group_id ${c.con_coll[k].group_id}</div>`
                            con_coll_string +=  `
                            <tr>
                                <td>${c.con_coll[k].created_at['$date']}</td>
                                <td>${c.con_coll[k].sender}</td>
                                <td>${c.con_coll[k].sender_mobile}</td>    
                                <td>${c.con_coll[k].is_sender}</td>
                                <td>${c.con_coll[k].receiver}</td>
                                <td>${c.con_coll[k].receiver_mobile}</td>
                                <td>${c.con_coll[k].is_receiver}</td>
                                <td>${c.con_coll[k].group['$oid']}</td>
                                <td>${c.con_coll[k].group_id}</td>
                            </tr>`
                        }
                        con_coll_string +='</table>'
                        cstring+=con_coll_string;
                    }
                    aa1.innerHTML += `<button type="button" class="btn btn-info" data-toggle="collapse" data-target="#collective">collective(${res.data.collective && res.data.collective.congroups && res.data.collective.congroups.length || 0})</button><br>
                    <div id="collective" class="collapse"> ${cstring}</div>
                    `
                } else {aa1.innerHTML += `<button type="button" class="btn btn-info" disabled>collective(0)</button><br>`}
                
                
                c = res.data.concards; //    //
                concards_str = ''
                for (let i=0; i<c.length; i++){//tuhain consumeriin cards-n toogoor davtana.
                    cardid=d.cards[i]['$oid'];  //card buriin id ni cardid-d onoogdono.
                    receipt_str = ''
                    concards_str += `
                    <div class="card">
                        <div class="card-header" id="heading${i}">
                        <h5 class="mb-0">
                            card#${i+1} _id: <a href='card?id=${cardid}'>${cardid}</a> num: ${c[i].number} ct: ${c[i].card_type} bal: ${c[i].balance} st: ${c[i].status}  mobile: ${c[i].mobile} 
                            <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapse${i}" aria-expanded="false" aria-controls="collapse${i}" onclick="getreceipt(${c[i].number}, 'collapse${i}')"><span class="badge badge-light">receiptCnt</span></button>
                        </h5>
                        </div>
                        <div id="collapse${i}" class="collapse" aria-labelledby="heading${i}" data-parent="#accordion">receipt haij bn.</div>
                    </div>
                    `
                    accdiv = document.getElementById('accordion');
                    accdiv.innerHTML = concards_str
                       
                }
            }
            };
            xhr.send(null);
        }
        //<span class="badge badge-light">receiptCnt: ${c[i].data.length}</span>
        function getreceipt(cnum, id){console.log('getreceipt', cnum, id); 
            const myInterval = setInterval(incProgbar, 1000);
            var xhr = new XMLHttpRequest(); 
            xhr.open('POST', '/api/receipt', true);
            xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xhr.responseType= "json"
            xhr.onload = function () {
                clearInterval(myInterval); pbx = 0; pb.style=`width: 0%`; pb.setAttribute('aria-valuenow',0)
                let data = xhr.response; console.log('res->getreceipt', xhr.response); 
                receipt_str = ''
                if(data.length >0){    //tuhain card receipttei eseh
                    receipt_str += `<table border=1><tr><th>billno:</th><th>cDate:</th><th>card_no:</th><th>samo:</th><th>bamo:</th><th>tamo:</th><th>camo:</th><th>bonamo:</th><th>tertoken:</th><th>custoken:</th><th>totpoint:</th><th>befbal:</th><th>poibal:</th><th>cusmob:</th><th>is_returnCnt</th></tr>`
                    for(let j=0; j<data.length; j++){
                        receipt_str += `<tr><td>${data[j].bill_number}</td><td> ${data[j].created_at['$date']}</td><td> ${data[j].card_number}</td><td> ${data[j].spend_amount}</td><td> ${data[j].bonus_amount}</td><td> ${data[j].total_amount}</td><td> ${data[j].cash_amount}</td><td> ${data[j].bonus_amount}</td><td> ${data[j].terminal_token}</td><td> ${data[j].customer_token}</td><td> ${data[j].total_point}</td><td> ${data[j].before_balance}</td><td> ${data[j].point_balance}</td><td> ${data[j].customer_mobile} </td><td>${data[j].rec_return.length}</td></tr>`;
                        let rec_return_str = ``
                        // if(data[j].rec_return.length >0){    //tuhain receipt returntei eseh
                        //     let rec_return =  c[i].data[j].rec_return;                                
                        //     for(let p=0; p<rec_return.length; p++){
                        //         rec_return_str += `bef_bal:${rec_return[p].before_balance} bpt_bal:${rec_return[p].point_balance} `
                        //     }                                
                        // } else {rec_return_str = ` rec return len = ${data[j].rec_return.length}`}      
                        receipt_str += `<tr><td colspan=15>${rec_return_str}<td></tr>`                     
                    }
                    receipt_str +='</table>'                    
                }
                document.getElementById(id).innerHTML = receipt_str
                
            }
            xhr.send(`cnum=${cnum}`);
        }
    </script>

</body>
</html>